<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Princesa Bianca</title>
    <!-- Estilos mínimos de ejemplo -->
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .gift-card {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .gift-card img {
            max-width: 150px;
            display: block;
            margin-bottom: 10px;
        }

        .taken {
            background-color: #f8d7da;
        }

        button {
            background-color: #008CBA;
            border: none;
            color: white;
            padding: 10px;
            cursor: pointer;
            border-radius: 4px;
        }

        button:disabled {
            background-color: grey;
            cursor: not-allowed;
        }
    </style>
</head>

<body>
    <h1>Lista de Regalos para Bianca </h1>
    <div id="gift-list"></div>

    <!-- Incluimos los scripts de Firebase -->
    <script src="https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js"></script>

    <script>
        // TODO: Pega aquí tu configuración de Firebase (firebaseConfig, etc.)
        const firebaseConfig = {
            apiKey: "AIzaSyAWoPF5xHwBF1dGnD_fKO9Nv0Nhri8bq1I",
            authDomain: "lista-de-regalos-shower.firebaseapp.com",
            projectId: "lista-de-regalos-shower",
            storageBucket: "lista-de-regalos-shower.firebasestorage.app",
            messagingSenderId: "53706984936",
            appId: "1:53706984936:web:8454e512464caeed99a85d"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        console.log("¡Firebase inicializado!", app);

        // Referencia a la colección "gifts"
        const giftsRef = db.collection("gifts");

        // Seleccionamos el contenedor donde mostraremos la lista
        const giftList = document.getElementById("gift-list");

        // Función para renderizar los regalos en pantalla
        function renderGifts(gifts) {
            giftList.innerHTML = ""; // Limpia la lista

            gifts.forEach((doc) => {
                const gift = doc.data();
                const giftId = doc.id; // ID del documento
                const div = document.createElement("div");
                div.classList.add("gift-card");
                if (gift.status === "taken") {
                    div.classList.add("taken");
                }

                // Estructura de cada tarjeta de regalo
                div.innerHTML = `
            <h2>${gift.name}</h2>
            ${gift.imageUrl ? `<img src="${gift.imageUrl}" alt="${gift.name}"/>` : ""}
            <p>${gift.description || ""}</p>
            <button id="btn-${giftId}" ${gift.status === "taken" ? "disabled" : ""}>
              ${gift.status === "taken" ? "Ya está seleccionado" : "¡Lo quiero regalar!"}
            </button>
          `;

                // Escuchar click en el botón
                const button = div.querySelector(`#btn-${giftId}`);
                button.addEventListener("click", () => {
                    reserveGift(giftId);
                });

                giftList.appendChild(div);
            });
        }

        // Función para marcar un regalo como "taken"
        function reserveGift(giftId) {
            giftsRef.doc(giftId).update({
                status: "taken"
            }).then(() => {
                console.log("Regalo reservado");
            }).catch((error) => {
                console.error("Error al reservar regalo:", error);
            });
        }

        // Obtener la lista de regalos en tiempo real
        giftsRef.onSnapshot((snapshot) => {
            const docs = snapshot.docs;
            renderGifts(docs);
        }, (error) => {
            console.error("Error al obtener los documentos:", error);
        });
    </script>
</body>

</html>